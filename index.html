<!DOCTYPE html>
<html>

<head>
  <title>HALA MADRID</title>
</head>

<body>
  <input id="publish-button" type="submit" value="Click here to Publish" />
  <br />
  <input id="create-user-button" type="submit" value="Click here to Create User" />
</body>

<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.21.7.min.js"></script>
<script>

  const uuid = '736994';
  const pubnub = new PubNub({
    publishKey: "pub-c-0f45817e-a821-4d8b-9e50-6a0582cb8ac4",
    subscribeKey: "sub-c-472d7842-645d-11ea-b5f8-9a833ea0503a",
    uuid: uuid,
    presenceTimeout: 30,
    authKey : 'eyJhbGciOiJIUzI1NiJ9.eyJyYXIiOlt7ImlkIjo1LCJuYW1lIjoic3R1ZGVudCJ9XSwib3MiOiJ3ZWIiLCJpZCI6MTIsInRwIjoiYXQiLCJ0aWQiOiJzdHVkZW50IiwiY2lkIjoiMSIsImlhdCI6MTU2NzU5ODE4MiwiaXNzIjoiTm9vbiBBY2FkZW15IiwiZXhwIjoxNTk3NTk4MTgyfQ.h5_bmsh6KVR4JGTQdnoi0Cj6z9SaQjSBArKmBvtzNm4'
  });

  const button = document.getElementById('publish-button');
  const createUserButton = document.getElementById('create-user-button');

  button.addEventListener('click', () => {
    pubnub.publish({
      channel: "pubnub_onboarding_channel",
      message: { "sender": uuid, "content": "Hello From Client" }
    }, function (status, response) {
      console.log('response of publishing the event: ', status, response);
    });
  });


  createUserButton.addEventListener('click', () => {
    pubnub.setState(
      {
        state: {
          "name": "Cristiano Ronaldo",
          "email": "ronaldo@juve.com",
          "gender": "male",
          "profile_pic": "Hala madrid"
        },
        uuid: uuid,
        channels: ['pubnub_onboarding_channel']
      },
      function (status) {
        // handle state setting response
      }
    );
  });

  pubnub.subscribe({
    channels: ['pubnub_onboarding_channel'],
    withPresence: true
  });

  pubnub.addListener({
    message: function (event) {
      let pElement = document.createElement('p');
      pElement.appendChild(document.createTextNode(event.message.content));
      document.body.appendChild(pElement);
    },
    presence: function (event) {
      let pElement = document.createElement('p');
      pElement.appendChild(document.createTextNode(event.uuid + " has joined."));
      document.body.appendChild(pElement);
    }
  });

  pubnub.history(
    {
      channel: 'pubnub_onboarding_channel',
      count: 10,
      stringifiedTimeToken: true,
    },
    function (status, response) {
      let pElement = document.createElement('h3');
      pElement.appendChild(document.createTextNode('historical messages'));
      document.body.appendChild(pElement);

      pElement = document.createElement('ul');
      let msgs = response.messages;
      for (let i in msgs) {
        msg = msgs[i];
        let pElement = document.createElement('li');
        pElement.appendChild(document.createTextNode('sender: ' + msg.entry.sender + ', content: ' + msg.entry.content));
        document.body.appendChild(pElement);
      }
    }
  );

</script>

</html>